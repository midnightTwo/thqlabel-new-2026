# ‚ö° –ë–´–°–¢–†–ê–Ø –£–°–¢–ê–ù–û–í–ö–ê –°–ò–°–¢–ï–ú–´ –°–í–Ø–ó–ê–ù–ù–´–• –ê–ö–ö–ê–£–ù–¢–û–í

## üö® –í–ê–ñ–ù–û: –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º!

**–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —É–¥–∞–ª–∏—Ç —Å—Ç–∞—Ä—É—é —Ç–∞–±–ª–∏—Ü—É `linked_accounts` –∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –Ω–µ–π!**

## üìã –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

### 1Ô∏è‚É£ –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞: https://supabase.com/dashboard

### 2Ô∏è‚É£ –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor

1. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
2. –í –ª–µ–≤–æ–º –º–µ–Ω—é –Ω–∞–∂–º–∏—Ç–µ **SQL Editor**
3. –ù–∞–∂–º–∏—Ç–µ **New Query**

### 3Ô∏è‚É£ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: `sql/COMPLETE_LINKED_ACCOUNTS_SETUP.sql`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ** —Ñ–∞–π–ª–∞
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
4. –ù–∞–∂–º–∏—Ç–µ **RUN** –∏–ª–∏ **F5**

### 4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

```
‚úì –¢–∞–±–ª–∏—Ü–∞ linked_accounts —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ
‚úì RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã: 4 —à—Ç.
‚úì –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã: 5 —à—Ç.
‚úì –§—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã: 2 —à—Ç.

========================================
‚úÖ –£–°–¢–ê–ù–û–í–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!
========================================
```

### 5Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
npm run dev
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. **–í–æ–π–¥–∏—Ç–µ** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∫ **owner** –∏–ª–∏ **admin**
2. –û—Ç–∫—Ä–æ–π—Ç–µ **–ö–∞–±–∏–Ω–µ—Ç** ‚Üí **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** (Settings)
3. –í –ø—Ä–∞–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ –Ω–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"–°–≤—è–∑–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã"**
4. –ù–∞–∂–º–∏—Ç–µ **"+ –î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç"**
5. –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞ –ø–æ—è–≤–∏–ª–∞—Å—å - **—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!**

## üêõ –ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –≤—Å–µ –µ—â–µ –µ—Å—Ç—å:

### –û—à–∏–±–∫–∞: "Unexpected token '<', "<!DOCTYPE"..."

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞ –∏–ª–∏ API –Ω–µ –º–æ–∂–µ—Ç –∫ –Ω–µ–π –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase Dashboard ‚Üí Table Editor
2. –ù–∞–π–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `linked_accounts`
3. –ï—Å–ª–∏ –µ—ë –Ω–µ—Ç - –∑–∞–ø—É—Å—Ç–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω—ã)

### –û—à–∏–±–∫–∞: "Access denied" / "Permission denied"

**–ü—Ä–∏—á–∏–Ω–∞:** –í–∞—à–∞ —Ä–æ–ª—å –Ω–µ owner –∏–ª–∏ admin

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí Table Editor ‚Üí `profiles`
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à—É –∑–∞–ø–∏—Å—å (–ø–æ email)
3. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ–ª–µ `role` –Ω–∞ `'owner'` –∏–ª–∏ `'admin'`
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. –ü–µ—Ä–µ–∑–∞–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –û—à–∏–±–∫–∞: "Failed to fetch"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º—ã —Å SUPABASE_SERVICE_ROLE_KEY

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `.env.local`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –µ—Å—Ç—å: `SUPABASE_SERVICE_ROLE_KEY=...`
3. –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–∑ Supabase Dashboard ‚Üí Settings ‚Üí API
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `npm run dev`

## üìä –ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º:

### –¢–∞–±–ª–∏—Ü–∞: `linked_accounts`
- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `primary_user_id` - –∫—Ç–æ —Å–æ–∑–¥–∞–ª —Å–≤—è–∑—å
- `linked_user_id` - —Å–≤—è–∑–∞–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
- `linked_email` - email —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
- `linked_nickname` - –Ω–∏–∫–Ω–µ–π–º
- `created_at` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `last_used_at` - –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### RLS –ü–æ–ª–∏—Ç–∏–∫–∏:
- ‚úÖ SELECT - —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏
- ‚úÖ INSERT - —Ç–æ–ª—å–∫–æ owner/admin
- ‚úÖ UPDATE - —Ç–æ–ª—å–∫–æ owner/admin
- ‚úÖ DELETE - —Ç–æ–ª—å–∫–æ owner/admin

### –ò–Ω–¥–µ–∫—Å—ã (–¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏):
- `idx_linked_accounts_primary_user`
- `idx_linked_accounts_linked_user`
- `idx_linked_accounts_email`
- `idx_linked_accounts_pair`
- `idx_linked_accounts_created`

### –§—É–Ω–∫—Ü–∏–∏:
- `get_my_linked_accounts()` - –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
- `can_manage_linked_accounts()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

## üéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Supabase:

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
SELECT public.can_manage_linked_accounts();

-- –ü–æ–ª—É—á–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
SELECT * FROM public.get_my_linked_accounts();

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
SELECT * FROM public.linked_accounts LIMIT 1;
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

- ‚úÖ RLS –≤–∫–ª—é—á–µ–Ω –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ
- ‚úÖ –¢–æ–ª—å–∫–æ owner/admin –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å
- ‚úÖ –ù–µ–ª—å–∑—è —Å–≤—è–∑–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç —Å–∞–º —Å —Å–æ–±–æ–π
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–∞—Ä—ã (–æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç –æ–¥–∏–Ω —Ä–∞–∑)
- ‚úÖ –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞:

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase Dashboard ‚Üí Logs
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ä–æ–ª—å = owner –∏–ª–∏ admin
