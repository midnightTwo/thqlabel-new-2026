# üîß –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ RLS - –°–ï–†–í–ï–†–ù–´–ô API

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç INSERT –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü—É `linked_accounts`

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–µ—Ä–Ω—ã–π API endpoint –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ö–æ–¥–∏—Ç RLS –∏—Å–ø–æ–ª—å–∑—É—è Service Role

---

## üìã –®–ê–ì 1: –î–æ–±–∞–≤—å—Ç–µ Service Role Key

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard: https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Settings** ‚Üí **API**
4. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **Project API keys**
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **service_role** key (‚ö†Ô∏è –ù–ï anon key!)

---

## üìã –®–ê–ì 2: –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤ .env.local

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```env
# –í–∞—à–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
NEXT_PUBLIC_SUPABASE_URL=your-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key

# ‚ö° –î–û–ë–ê–í–¨–¢–ï –≠–¢–£ –°–¢–†–û–ö–£:
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here
```

‚ö†Ô∏è **–í–ê–ñ–ù–û**: 
- Service Role Key –∏–º–µ–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ë–î
- **–ù–ò–ö–û–ì–î–ê** –Ω–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –µ–≥–æ –≤ git
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (API routes)
- `.env.local` —É–∂–µ –≤ `.gitignore`

---

## üìã –®–ê–ì 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å (Ctrl+C)
# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞:
npm run dev
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: http://localhost:3000/cabinet
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**
3. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ –¥–æ —Ä–∞–∑–¥–µ–ª–∞ **"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏"**
4. –ù–∞–∂–º–∏—Ç–µ **"–î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç"**
5. –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å –¥—Ä—É–≥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
6. –ù–∞–∂–º–∏—Ç–µ **"–î–æ–±–∞–≤–∏—Ç—å"**

‚úÖ –¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ë–ï–ó –æ—à–∏–±–∫–∏ RLS!

---

## üìÅ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `app/api/linked-accounts/route.ts` - –°–µ—Ä–≤–µ—Ä–Ω—ã–π API endpoint

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `app/cabinet/components/settings/AccountManager.tsx` - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç API –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Supabase

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

**–†–ê–ù–¨–®–ï** (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ):
```
–ë—Ä–∞—É–∑–µ—Ä ‚Üí Supabase Client ‚Üí RLS Policies ‚ùå ‚Üí –û—à–∏–±–∫–∞
```

**–°–ï–ô–ß–ê–°** (—Ä–∞–±–æ—Ç–∞–µ—Ç):
```
–ë—Ä–∞—É–∑–µ—Ä ‚Üí API Route ‚Üí Service Role Client (–æ–±—Ö–æ–¥–∏—Ç RLS) ‚úÖ ‚Üí –£—Å–ø–µ—Ö
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

API endpoint –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. ‚úÖ –ù–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
2. ‚úÖ –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. ‚úÖ –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑—ã–≤–∞–µ–º–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
4. ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
5. ‚úÖ –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üêõ –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env.local:**
   ```powershell
   cat .env.local
   ```
   –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞ `SUPABASE_SERVICE_ROLE_KEY=...`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:**
   - –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `npm run dev`
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞
   - Next.js –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è .env.local –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
   - –í–∫–ª–∞–¥–∫–∞ Network
   - –ò—â–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/linked-accounts`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 201)

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
   - –°–º–æ—Ç—Ä–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `npm run dev`
   - –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –æ—Ç API route

---

## üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
1. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `.env.local` (–ë–ï–ó —Å–∞–º–∏—Ö –∫–ª—é—á–µ–π!)
2. –°–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
3. –õ–æ–≥–∏ –∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞
