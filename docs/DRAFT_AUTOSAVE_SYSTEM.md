# Система автосохранения черновиков релизов

## Описание

Система автоматически сохраняет прогресс заполнения релиза в виде черновика. Это позволяет пользователям:
- Не терять прогресс при случайном закрытии браузера
- Продолжить заполнение релиза позже
- Видеть сохранённые черновики в своём кабинете

## Как это работает

### Создание черновика
Черновик создаётся автоматически, когда пользователь **завершает первый шаг** (Релиз):
- Указывает название релиза
- Выбирает жанр
- Загружает обложку
- Указывает дату релиза

### Обновление черновика
Черновик **автоматически обновляется** при:
- Переходе на следующий шаг (кнопка "Далее")
- Когда любой шаг меняет статус на "завершён" (галочка)

### Удаление черновика
Черновик **преобразуется в полноценный релиз** (статус меняется с `draft` на `pending`) когда:
- Пользователь нажимает "Отправить на модерацию" (Exclusive план)
- Пользователь нажимает "Оплатить" или "Оплатить позже" (Basic план)

## Запуск SQL миграции

Перед использованием системы необходимо выполнить SQL миграцию:

1. Откройте Supabase Dashboard
2. Перейдите в **SQL Editor**
3. Выполните скрипт из файла: `sql/ADD_DRAFT_STATUS_TO_RELEASES.sql`
4. Убедитесь, что ошибок нет

## Технические детали

### Статусы релиза
- `draft` — черновик (новый статус)
- `pending` — на модерации
- `approved` — одобрен
- `rejected` — отклонён
- `published` — опубликован

### Что сохраняется в черновике
- Основная информация (название, артист, жанр, обложка, дата)
- Тип релиза (single/ep/album)
- Треклист (без аудиофайлов — только метаданные)
- Выбранные страны
- Статус договора
- Выбранные платформы
- Промо-информация

### Хранилище
Черновики сохраняются в таблицу `releases_exclusive` со статусом `draft`.

## Уведомления

При успешном сохранении черновика появляется toast-уведомление:
- Зелёный цвет
- Текст: "Черновик сохранён"
- Автоматически исчезает через 2.5 секунды

## Файлы системы

- `app/cabinet/release/create/page.tsx` — основная логика автосохранения
- `app/cabinet/release/create/components/SendStep.tsx` — отправка на модерацию
- `sql/ADD_DRAFT_STATUS_TO_RELEASES.sql` — SQL миграция
